# 展望未来

- 原文链接：[Looking To The Future]()
- 作者：**JOHN BALDWIN**

FreeBSD 13.0 版本为用户提供了新功能，并优化了新贡献的工作流程。自 2018 年 12 月发布 12.0 版本以降，FreeBSD 的贡献者一直在忙于修复漏洞，添加新特性。此外，FreeBSD 的开发者们也进一步明确了他们的愿景，专注于 FreeBSD 未来的用户。以下是 13.0 版本中的一些变化的简要列表，详细列表请参阅发布说明。

## 工具的变革

在过去两年中，FreeBSD 项目的变化并非全部以补丁的形式出现。一些最大的变化体现在用于贡献代码的工具上。第一个重大变化是，FreeBSD 已经从 Subversion 转向 Git，用于存储源代码、文档和 Ports 。Git 在软件行业中被广泛使用，对于新贡献者来说，比 Subversion 更加熟悉。Git 的分布式特性也更容易促成非提交者的贡献。FreeBSD 多年来一直提供 Subversion 仓库的 Git 镜像，许多开发者已经使用 Git 来管理进行中的补丁。现在，Git 镜像已经成为官方仓库，所有更改现在直接推送到 Git 而不是 Subversion。FreeBSD 13.0 是第一个仅通过 Git 而非 Subversion 提供源代码的版本。该过程的第一阶段专注于将项目现有的工作流程和工具（如 Phabricator 和 Bugzilla）适配到新的 Git 仓库。下一阶段将使我们能够探索更多工具，如提交前测试和持续集成。

第二个重大变化是采用 AsciiDoc 作为 FreeBSD 文档和网站的源格式。FreeBSD 的文档包括三个主要部分：手册页、书籍和文章（如 FreeBSD 手册）以及项目网站。书籍和文章以前使用一种名为 DocBook 的 SGML 标记语言编写，网站则直接用 HTML 编写。虽然 DocBook 语言非常有表现力，支持诸如调用、脚注和索引等多种功能，但它是个冗长的格式。自从 DocBook 最初设计以来，轻量级的标记语言如 MarkDown 已经变得流行。AsciiDoc 是一种与 MarkDown 相似的轻量级标记语言，同时保留了 DocBook 的表现力。FreeBSD 文档团队最近已将所有书籍、文章和网站转换为 AsciiDoc 格式。这提供了一种更简单、易于阅读的格式，能使新贡献者更容易参与文档编写。

手册页仍然使用一种名为 mdoc 的 troff 方言编写。

## 规划后续系统

过去几年，FreeBSD 关注的一个变化是更加重视对用户未来将使用的系统的支持，而不是对越来越少用户使用的老旧系统的支持。这并不意味着放弃对所有非全新系统的支持。然而，随着一些老旧系统逐渐被历史淘汰，继续在代码树中维护对这些系统的支持已经不再具有足够的价值。FreeBSD 13.0 移除了对旧款 32 位 ARM 系统和 UltraSparc 平台的支持。同时，一些不再常用的旧设备驱动程序也被移除。此外，鉴于 64 位 x86 系统的主导地位，32 位 x86 架构已被降级为二级架构。

精简我们的关注点使得项目能够将更多资源投入到未来会增长的其他架构和驱动程序上。ARM、PowerPC 和 RISC-V 都经历了重大更新，包括对新驱动程序的支持和性能的提升。64 位 x86 架构现在支持 Hygon Dhyana 处理器，并且在更新的 Intel 处理器上支持 57 位用户虚拟地址。最后，13.0 版本中的所有架构都由内置的 LLVM 工具链支持，包括 clang 编译器和 lld 链接器。通过不再维护对遗留的 GPLv2 工具链的兼容性，FreeBSD 现在能够采用现代语言和工具链功能。（更多内容，请参见 Ed Maste 的文章，《FBSD 13 工具链》，也在本期中。）随着对基本系统中其他 GPL 许可组件的替代或淘汰的变化，这也意味着 FreeBSD 13.0 的基本系统中仅包含两个 GPL 工具和一个 LGPL 库。

## OpenZFS

FreeBSD 已经在基本系统中内置 ZFS 十余年。FreeBSD 的 ZFS 支持最初是从 OpenSolaris 移植过来的，并且长期以来一直跟踪公共 OpenSolaris（后来是 illumos）仓库中的 ZFS 支持。过去几年，ZFS 的活跃开发已经从 illumos 仓库移出，转向了跨平台的 OpenZFS 项目。FreeBSD 13.0 用 OpenZFS 的代码替代了来自 illumos 的 ZFS 支持。这带来了若干新特性，包括加密数据集和 ZSTD 压缩。（另见 Allan Jude 的文章，《OpenZFS 中的 Zstandard 压缩》，也在本期中。）

## 网络

13.0 版本包含了一些网络方面的变化。内核 TLS 卸载使得单个 Web 服务器能够传输数百吉比特的 HTTPS 流量（请参见 John Baldwin 的文章《内核中的 TLS 卸载》）。NFS 客户端和服务器现在支持 NFSv4.2。这包括一个新的系统调用，允许优化服务器端文件拷贝。NFS 客户端和服务器还支持通过内核 TLS 卸载进行 NFS over TLS。

## 安全

FreeBSD 13.0 的内核包含对内核加密框架的若干改进，该框架用于 geli(8)、ZFS、IPsec 和内核 TLS。64 位 ARM 系统现在将通过 armv8crypto(4) 驱动程序开箱即用地利用加速的软件加密，支持 AES-GCM 和 AES-XTS 加密算法。32 位和 64 位 x86 系统也通过 aesni(4) 驱动程序在默认内核中包括对加速软件加密的支持。

## 启动加载器

每个内核的启动加载器包含若干变化。首先，当从 UEFI 启动时，默认安装现在将完整的启动加载器安装到 EFI 系统分区。之前，EFI 系统分区中的一个小型启动加载器被用来定位并启动完整的启动加载器。这个双阶段的过程被证明不够灵活，固件现在直接加载完整的启动加载器。其次，在 x86 系统上，启动加载器现在在通过 UEFI 启动和通过 BIOS 启动时，都使用视频控制台上的图形显示。此图形控制台随后交给内核，由 vt(4) 驱动程序作为帧缓冲使用。

## 虚拟化

FreeBSD 13.0 在作为客户机和主机的虚拟化方面都有若干改进。内核中的 VirtIO 设备驱动程序现在支持 VirtIO 规范的第 1 版。这提高了与提供 VirtIO 设备的虚拟化管理程序、模拟器和仿真模型的兼容性。bhyve(8) 虚拟化管理程序包括若干变化，包括改进的 VNC 支持（包括与 macOS 中内建的 “Screen Sharing” VNC 客户端的兼容性）、VirtIO 9p 文件系统共享，以及对虚拟机快照的初步支持。

## 结论

FreeBSD 13.0 是过去两年中项目社区贡献的成果。感谢所有通过测试快照、报告 bug、提交补丁、在社交媒体上与用户互动以及执行无数其他任务的人。我们希望您喜欢 FreeBSD 13.0。加入我们，迎接下一次开发 FreeBSD 14 的冒险！

---

**JOHN BALDWIN** 是一名系统软件开发者。过去 20 年里，他在 FreeBSD 操作系统的多个部分（包括 x86 平台支持、SMP、各种设备驱动程序和虚拟内存子系统）以及用户空间程序中直接提交过更改。除了编写代码，John 还曾在 FreeBSD 核心团队和发布工程团队中任职。他还为 GDB 调试器和 LLVM 做出过贡献。John 与妻子 Kimberly 和三个孩子：Janelle、Evan 和 Bella 住在加利福尼亚州康科德市。
