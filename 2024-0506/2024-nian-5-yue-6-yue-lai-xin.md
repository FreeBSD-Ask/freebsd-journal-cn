# 2024 年 5 月/6 月 来信

- 作者：**Michael W Lucas**
- 原文链接：<https://freebsdfoundation.org/our-work/journal/browser-based-edition/configuration-management-2/we-get-letters-may-june


>亲爱的来信专栏，
>
>我的雇主有数十台服务器，我不知道有多少个操作系统。其中一台的运行时间比我还长，没人敢碰它。但有个傻瓜把一本电脑杂志留在了洗手间，老板发现了，现在他的脑袋抓住了“配置管理”作为解决所有问题的方法，而数据中心真正需要的是背包核弹。我怎样才能让他明白这些工具不适合我们这种环境？
>
>“我已经注定要失败了，问你也不会有什么影响。”

 亲爱的失败者，

“问我也不会有什么影响。” 好像系统管理员可以承受的痛苦有所限制，或者说他们会失败的程度有限。失败并非可以溢出的整数值。失败是一种社会构建，你的失败已经完全确定。

我们都看过配置管理的宣传。只需一个命令部署专用高度调优的服务器！用简单的 Playbook 调整计算云！从一个服务器无缝透明迁移到另一个服务器！容器！对于从零开始的人来说，这很好，但大多数系统管理员工作在最好描述为“巴洛克”的环境中，如果不是“史前”的话。我发现自己只有在亲自耕耘土地等待三叶草长出时才有绿地。不是草坪。草坪是气候的暴行。除非你养羊。或者山羊，但如果你养任何类型的山羊，你不会长时间拥有草坪，这表明任何善行也是荒漠化的代理。此外，谁想在安装数据中心之前等待三叶草呢？推倒那所被夷为平地的幼儿园的废墟，继续你的一天。

配置管理是其中一件广告理想与减少痛苦为敌的事情。是的，加拿大冰球联盟可以通过一个完整的 Web 服务器群动态管理其整个国民同时观看纪念杯最后一场比赛的负载，我告诉过他们也可以通过增加心理健康设施来处理伦敦骑士队输给萨金诺骑灵队时的沉重抑郁 —— 他们甚至不是加拿大人！你呢？不太可能。动态采购是动态供应的前提条件，而你显然两者都缺乏。

但是你可以部署配置管理，并非恶意遵从的意义上。跳过管理整个服务器群的魔法仙尘。你的舰队甚至不能用一把椅子、一根鞭子和一把火焰喷射器管理。但你系统中痛苦的部分可以得到控制。

配置管理是系统管理工具。因此，使用它来满足您的需求。从少量系统开始。配置一个具有访问权限的管理账户，以便您的管理系统可以 ping 这些主机。恭喜您 — 您已经实现了恶意合规！这满足了您的管理需求，但不符合您的管理需求。

每台服务器都是独特的雪花，尽管是一种患有狂犬病的雪花。当您开始控制这些系统时，从相对简单的东西开始，具有已知的良好值，在 Unix 变体中基本一致。关于问题有一个陈词滥调：“一切问题都是 DNS 问题。”问题总是 DNS 问题，因为系统管理员不理解 DNS，并且在名称服务器更改时不一致地更新 /etc/resolv.conf。这是我总是开始的地方。您不仅在初步配置管理下使系统生效，还要对当前的 DNS 配置进行审计，作为该项目的先决条件。您的经理会喜欢它。将您的主机按操作系统分组，并将它们的解析器纳入您的管理范围。如果您友善的话，注释该文件。

`# under configuration management# your changes will be overwritten without a human ever seeing themsearch mwl.io tiltedwindmillpress.comnameserver 203.0.113.53nameserver 2001:db8::53`

恭喜！您已经控制了 DNS 解析。它会经常更改吗？希望不会。但是您现在可以轻松地进行更改。如果您希望别人认真对待您，您必须始终实施您的威胁，因此请安排每月运行配置管理以更新 resolv.conf。

你可以合法地声称你的主机已经在配置管理下运行，但你还没有利用它让生活变得更轻松。看看另一个常见的服务，每个主机都有但通常配置不一致的：SSH。你的组织可能有像“禁止基于密码的认证”这样的规则。如果没有，等到发生安全事件再提议。绝不能浪费一场好危机！锁定 SSH 并确保它保持锁定的最简单方法是将 sshd_config 纳入集中管理。是的，每个操作系统都有自己的 sshd_config 调整，因为在集成软件之前，Unix 的维护者们总要将其搓捏成自己喜欢的样子，但管理系统使用模板来适应这种不卫生的行为。你可能能在通勤路上睡着的时候背诵默认的 sshd_config，所以确保你的管理配置看起来与默认配置截然不同。

`#Configuration Under Management#Manual Changes Will be OverwrittenPort 9991PasswordAuthentication noSubsystem       sftp    /usr/libexec/sftp-server`

任何系统管理员认为“我只需注释掉默认选项”都会对此感到非常警觉，直到这种感觉蔓延至他们的脑干。

逐步，你可以将环境的广泛部分纳入你的控制之下。对受管理服务的更改将变得微不足道。同事们会看到这一点。关于改变不受管理服务的讨论将变成“我们如何将这项服务纳入管理？”利用这些讨论来实施环境中必要的变更，或者让自己得到一个更好的第四个监视器。毁灭是一种社会构建，但通过配置管理，你可以将其转化为一种保护性shell。或者一把撬棍。至少，你可以分享那份痛苦。

部署配置管理很少被讨论，但有一个可怕的副作用：控制环境的人，控制着环境。任何变化都必须经过你。人们不能在那台面向公众的服务器上永久启用密码验证，但这并不意味着他们不会向你抱怨。他们会期望你参与解决问题，没有人能够在变成一个解决问题者的情况下生存。那无法根除的声誉污点将只会让你成为公司替罪羊的称号。

幸运的是，你已经知道山羊是干什么用的了。开始吃草吧。

有关于迈克尔的问题？发送至<letters@freebsdjournal.org>。

**Michael W Lucas** 是 *Networking for System Administrators* 等多本著作的作者，他还犯下了许多其他危害人类文明的罪行。其中的专栏文章集《Dear Abyss》（亲爱的深渊）即将在 Kickstarter 上启动，他的预谋证据确凿。详情请访问 https://mwl.io/ks。
